---
title: "Import gene sets from GMT files"
author:
  - name: Axel Klenk
    affiliation: Dept. of Medicine and Life Sciences, Universitat Pompeu Fabra, Barcelona
    email: axelvolker.klenk@upf.edu
  - name: Robert Castelo
    affiliation: Dept. of Medicine and Life Sciences, Universitat Pompeu Fabra, Barcelona
    email: robert.castelo@upf.edu
date: "`r Sys.Date()`" 
output:
  bookdown::html_document2:
    base_format: rmarkdown::html_vignette
    fig_caption: yes
    toc: true
pkgdown:
  as_is: true
bibliography: GSVAEuroBioC2024.bib
link-citations: yes
vignette: >
  %\VignetteIndexEntry{Import gene sets from GMT files}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---


```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Vignette built using `GSVA`, version `r packageDescription("GSVA")[["Version"]]`.

# What are GMT files

An important source of gene sets is the
[Molecular Signatures Database](https://www.gsea-msigdb.org/gsea/msigdb)
[@subramanian2005gene], which stores them in plain text files following the
so-called
[_gene matrix transposed_ (GMT) format](https://software.broadinstitute.org/cancer/software/gsea/wiki/index.php/Data_formats#GMT:_Gene_Matrix_Transposed_file_format_.28.2A.gmt.29).
In the GMT format, each line stores a gene set with the following values
separated by tabs:

  * A gene set identifier.
  * A gene set description.
  * One or more gene identifiers.

Because each different gene set may consist of a different number of genes, each
line in a GMT file may contain a different number of tab-separated values.

# How to read GMT files

We can read GMT files using the `readGMT()` function from the GSVA package.

```{r, message=FALSE}
library(GSEABase)
library(GSVA)

URL <- "https://data.broadinstitute.org/gsea-msigdb/msigdb/release/2023.2.Hs/c7.immunesigdb.v2023.2.Hs.symbols.gmt"
genesets <- readGMT(URL, geneIdType=SymbolIdentifier())
length(genesets)
genesets
```

## Differences between `readGMT()` and `getGmt()`

Function `readGMT()` from package GSVA is based on the `getGmt()` function from package GSEABase and behaves almost the same.  It has, however, two extensions that may prove useful in certain cases.

### GMT files with duplicated gene set identifiers

When responding to a user issue, we discovered that some GMT files contain duplicated gene set identifiers, although this is forbidden by the file format's definition, and, consequently, `getGmt()` refuses to read them.

```{r, message=FALSE, error=TRUE}
URL <- "https://data.broadinstitute.org/gsea-msigdb/msigdb/release/7.5/c2.all.v7.5.symbols.gmt"
genesets <- getGmt(URL, geneIdType=SymbolIdentifier())
```

In such a case, `readGMT()` will rather warn about the problem and resolve it using one of a range of strategies that are described in more detail on its help page (see `?readGMT`).

```{r, message=FALSE}
URL <- "https://data.broadinstitute.org/gsea-msigdb/msigdb/release/7.5/c2.all.v7.5.symbols.gmt"
genesets <- readGMT(URL, geneIdType=SymbolIdentifier())
genesets
args(readGMT)
```

### Return a `list` instead of a `GeneSetCollection`

Using gene sets in a `GeneSetCollection` object offers a number of advantages inluding automatic gene identifier mapping and therefore `readGMT()` returns such an object by default.  If, however, a user prefers using gene sets represented as a `list` of `character` vectors, this is possible without multiple conversions by setting argument `valueType="list"`.

```{r, message=FALSE}
URL <- "https://data.broadinstitute.org/gsea-msigdb/msigdb/release/2023.2.Hs/c7.immunesigdb.v2023.2.Hs.symbols.gmt"
genesets <- readGMT(URL, valueType="list")
head(genesets, 2)
```

# Session information

```{r}
sessionInfo()
```

# References
